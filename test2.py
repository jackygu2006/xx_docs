from scipy.optimize import fsolve
import math

P = 42000 # Total era reward
StakeLimit = 2000000 

accounts =  [0, '6YjhkzRCcQvYXTJi7EP1mKzFXm9h6Ct65v4B1ugw4f7rnJxE', '6WXn2R5bqQFDKEfb7MMGWERV1b9VaCfcY6TUWt7zxD8Z3jjM', '6VKP5bVgJsn3jnrtfcjnKeCXtDM8ow5oqN1kdr5zD7cixwfR', '6YTxT1iyc7DPjpNXLPzijanR3zLeJoYqHv867ZwvmqUNQdpt', '6VV6VMPxKGCr6pJSp2r7ftvoMokRJGym79wqVGC8PDUfVWUQ', '6Y2dskdRsFxSobeeB76pDenbzW98eaiF1A4bBQtFMrv4YDnX', '6WteLswxK1qpGhZH8tZ9Tw5w2pUQnUDwKLQjjb4tYLKsweS4', '6VfqjX9gf2bC2bvkvf7w5cGv9q1TGRGoTQTfX1Mud5W2uohS', '6WtLsbPkztf43vjrksuLEN4odtHmFNooB2CCYv3XpoYGnReM', '6ayP5gSrLB4mKhZY59VEmqfYjn6pCaZ4anxXTqnCvvGyCwD2', '6WwHRQgwFkmhzG3p8cvLPDoe39nkvb9877DnSZD2ddmzNBBk', '6XJ2rr88nBgUcvDtFoGQSiPvPYTzidZ5ZHbEDqwLyBx7dCs1', '6WkVhnWVaavwAtPbjCrSNCMnXj7Fj1XHAEwuNuPr2CdNMssG', '6XLb1ZJrihTzUaZde6G6XEr91jnC3h3hJ3PVg1cuMaiBMwQD', '6aKcuy2aoXA3s1f9JYXiWvY926nHtpEu9mMz4DMURFHNvHdZ', '6VosbJXBD3fqpdaovAi1BVcHsPnRTmpCgRF9tqLVhMPG2z8y', '6ZhrpbMadopQE7dhq4mKXzEBgsfMVAo39yds2UCpAVw2HSFP', '6aE7nMQXGbCUYVi4jcGKxS8VQUdWD7xZWvvc74pFA288xujP', '6aprZrw6imaLw1EfW6JCiJDctC1PPYMYie4xwPxzGfFAKraj', '6Y2EoZ3sikGTjS2paPwv7HMSRqKV8nqu9yDT6whPyYoBMKsy', '6XvrJTbymUn21UhXvpCdmrVhLxwtjVVGgr2j6fmRwnt9ZuYP', '6aqDXrb72KWtP6rLxghK1PkrzGG13BVhpJY3v4jDZYwSAXjV', '6VqnEvPy2S6ngv2wEKEcjhz4J5UosEU2NuJNei16quqpvJ7T', '6WaWq6R8B3n7tVuzYj9uFS6ZJMbfmZqx97rcuYqHoPWLUx7L', '6VapwtSYE3q6Ea3JLz7krezamf5J7fZpxunDwQK2ja4zC4BC', '6VUsV1zjrnBJRgvRAEkbTTGUBJ4Km47uaAhADYsKE1mcoSru', '6Vm8ffQyYNj9zYgtzzXkmrcf9XiD57xUrVuPp8L47Q9rnPcH', '6YfTEcfUGXhcJibFCqtDAK3Eari5DUpe2X9FRS4sBwMhvFCS', '6aqVm4B8mkNXPSmhquk95Eh8B23jnGFBkktmvHGPBLfvtLfY', '6YbnK95QZBZ3dqe1kNj2kcAZ2toj6T5bypXAqsQANC21tviG', '6YnWGrtqHG73r8PEnNvKBtBjEjnjY9yyRXShQ6GpeqQ54wBv', '6WBJz51panWZaYe7Px2Tx8EwJxfAVTn7yTmeWgKMmTwZ4s4k', '6YEoe6N2K1yuiyXockNj6FdcP1dVzGFJGLKL3PWeX4r5EQnC', '6VgLbsTYK763mvcXv7Vpj8Qsj4ZkQAYohfRMaEE1wrA2SPw6', '6ZjtGawffFWrRttNBvYWmHv1Teg1Sa4twzmt8yPMDEkf7Ygr', '6aF97WFzcP4dJZ8Bq8gaDy2cemGrTmtDaFSpPEPRaVnHT6C4', '6XJZd6JNEzAJ88Bjbs9ZVLM6TbQ8VA3EZewbfaTzLwqtvw5m', '6Xz5sSwcyou3Js4a3W15cDQYwToVgRWQjvzePEBgonka7CmW', '6X9tojfXMn9ipyRkETqB2ypEeWpUEfW6gejHpQQVnj9nmFJT', '6ZRhphaxF54YXZxDuBkDJNt5xjULZfbYDSNqrM3GfT1VAmzw', '6axB72NzHf7VAu99cQ6UbqzJnSDjd4KrkNeXBuzqzeRMhRcA', '6YfWhbcRqQahm4YnBbDZrq7gEZgdaCKY1A361nxQjuyY9wJ4', '6VuHaSN6rTXy1PJSFYLqjpCkY3z9hokqyHFUyFwjZX3Jduu4', '6a4nBbr9D7r9rbY7kGmWvzjQAFqEAUeA26gQo8hmEf62wVuy', '6a9sP4NF21k1E2YaVDLaRGssuLMNTponrMdAzGaEbEcNWbZx', '6a6Ti9ZzE7JQqvMx88MZB5atwiWCGwSSgpstqwHvG83CjUvm', '6XJmBPmTNySMHxeSyKxP1pWNfCr8JNfmyf41ybz8Srb6PZ6E', '6Vu5Ba1ZDJjnjwnFJVCp6p3gTU9G4oCNq6DmJzNCYMBBvc4r', '6YjyZ9xyUbYZhWijVVBceUTQXsnNAYTAMr4WX8UiXjNC2rPe', '6YvPxCto9QQwqgyBYz2JypN6ndDHcDc4irPDAJAQ6XutRgv3', '6VxGEybRasAYhrATyM1Bh5yC3cJxwEVC4Y6uNRBqjKTjYz7c', '6WaJy8rEjtUfcZzDwdQ6qvDDWtnxkVwcmNhw7HcyjYyiFGLG', '6XvWxQui3647iReRzMEAe3hdPSMtV61C9hYxbaLnoPGM4fJ8', '6WCp6uTSoG45eXoqRG45RknWwGJWoutoNdLZEhTn8bRjGj1P', '6VquFJdMeRsZXFwnx4YHidKBS2A6pDubHq5bb59rjT458eMf', '6XfiFEW89LZiX7pFRihAVTk4odz4NJ4FgF5SfGHyQmMUSyvc', '6aByB8ZjvRm23bdTxXAdeYW2KnwkzdfPU5fhANicjjEnsENB', '6X9un2FrLrS5gxx5mYWCCGg8cXcuoZRgnoRCs2TaHmEbnUUW', '6Wfy3CSuEFKxfgXKL7xS7AofsRxHQnjf48YFuMzKxjUAy8EA', '6WMpg7VNzJio9fGQNdMnsjHoMjtGnne4F7tC3drtyoBLV7vY', '6ZPVAr3yiu4xgZ6V9mTuEJNniJEiAMRVk8vzb9hCqceTWaZW', '6YeyBmoE7AWT9d87dhFxUJdH1FFLwHWQZGHdmB7pPUp6E4Sp', '6Z9KCWCuqN5jJNx88B9TJ34iw5fr72zNxcSQfw9HucJQcAFA', '6X36bwZi9QfCTh1gFJBitwxvMxSHp3dcRhKNMKSRHMoEZntW', '6Z6vYyPVe9abGb2JVip5SCv4EDmiUFqojduwLqwfSn5YETqq', '6X3DCcMgAsorR3eJEHJFMbpLqzS3jnz8vpgS3js4Mu6mRaj7', '6ZZrf2cUrh5TBXU9BzRL7UEsWfxH4shQFfwqS5vjVHxJ235T', '6ae5jDdA8Li3rDxEtgRfExynwscbyfPgpoGmqHNphSfsbZpw', '6Z6r4sUdJzURm8F135KRMaPtyPLk5J76NuWdSxh8ArR1jnaE', '6XJT8hi5Hwx4yVcqNN6LqQZwc8tzhekZnjU2i1RL8Tbeine8', '6WKFuHZJzi5zbFd4bgh76W1JPx5TigBmEJ4wkYnap93Yck8i', '6Z6nU2akS4vbuAmZ5uH2eKmDChwuVKShx5i5YoreP9aeq1Z3', '6aTwvyJzgswbJgqEp4EGiNFckZDD1sL7TgNcxmtPWYTGyvnq', '6WMsRFXaJVUjB1ufh74sYDVZkEktpfjE38zMV4KeiHU2fN3s', '6XqXfiGyAz4jPRaXdoaTWZJPsK9yMwdihc6CBBfWARh5dWr3', '6Xk5TiRpT2eFV7VHwtkR36e3j2D8s4c1mYDqk8RjjuxuM7Po', '6YF1HV5Y5k3STniw4GKqDufXVKWc57BGC443p1W3VS6MYrZ8', '6ajYPHaqhxz5jSEpzJDh3ovWLrgdZ8Vu8HRMaWKAHXKwuRhg', '6XUX2BaGnbzokxHby7hqb7RVNKKnYQCZAFFo7pNBUcnoAnQP', '6VSduRsfo5nnZW4aafVvE8wdSq8tpuSTLWxqT1STqRcqy2kg', '6W7vwrpJd38G2x3HbnLcJst7LzPzJQ6etEjCcbByJzeMQjXE', '6XqPDHK6xw2ek2zewsWyoafaLzYpxJPn9D1RhKNnD2U3U2G3', '6YWZReaAAiT9p6aTXMVXxdLPkTehk7mspysz4XdjXEzez7KP', '6ZsqCoFPFyNABurKzkvc8vo2LPdr6fvfUtrjbsGZxN4gUSHA', '6agYSwtSM4AVwxBjVDaVcC9SVwUZa9a6xcZERLoYdJHJVH2T', '6axWahYH28igVhwteB8s64xYcPaLUKUaCybQJHhATruvDKGe', '6Z2KEMk14tsmNJL9Gb5sCu4SXBcKYVWqwitXYMuADNQFfhYp', '6XcpTfzbrZWupPLKthbZ5YJcFFdHxK4b9Je5ARhhwLJ2pAHm', '6XtJEhLqDWeVkzteBt8Qdn6155LLYmgnef2FjaKbhK6ZVN3B', '6X5TE6TM4o8eyDvsB83zNnZnZUKRftX3MeAZDZbK18DoFS1F', '6ZC1JBRwaJwzSAERrz2USv3Bztn8XgbafUt2PQtWKCmYNLa9', '6WkuzpX6Z3mataoeZYZ3Cdpk3XizX3526GxSKh1YrZFYoZ1U', '6X7HD6Tyuh49X4NPy17V6Q1pERrGnHQrHJG3cPQu8bPRshBK', '6XiK7tiHuJ5tWXtJJmhbWsS3h7ovdQYp38RQzY6wWqc2AWMQ', '6W5riDnAmZwNsoYwpytGepMzTvXfcHYeS1rLeZDTeL5KTtSH', '6ViLcHEH6ujkovt5C3dit8jUza5dq24V9AKbtoS34ffxTMVA', '6a3paYochic4YVwoGxu8PNdZWaHLvF8CAGP3W5x8BHZeJ4RA', '6VmFmejC5TLb4LE85CCgNaTUdZd5GmeAgc8NhKv5PmfHV8L3', '6aRT5aegWS57R9ZF3PZeSH3E5tpC8R8cC7hMjdQV4qXksSx6', '6Yv5aSM6DVPWcUqSG4bCAbZf9RZdx8awE9ANyeuFa5QHgZnk', '6ZKvuNC9PDVKC8HYU5Xsx5bzZzYahZ2Do4yfkai298S29HCV', '6WPwdSYHvoSj9Ga6wrByz5byYx93o6nGXDPekXVX84LxkiGL', '6Ww4ixwUhXUrJW6BFnz1xkzmPJvsUGbgp486Q55TSDWp2Hin', '6W5EAVQ6YrbenWEUKNrmyj4233HscegRDtCwH9GLUFf3s9SX', '6YCLApJCrWo2b1i6ZLi2rmsLCDMnbh3QVgwNe5YMgoyNSxyY', '6ZsMetbm4yoj9JQJdmhn2dKScFNkUnxULXwTBsNpmL1FM3KY', '6Zerqx4FGws5Hn86vodryjiasr5grF9EKGWvaUPu9kCkL4bY', '6ZbmUc2MFHLp9wsxgJgPPx3r4GYqFETbWYCaQ484bADFntJB', '6Vw4PYpZgjxtxxXxgeHtW19Pg1BxXRm2bwwBfh9KdDu5E4yD', '6Vcqq5SoUTRY2ZZ361BVfASa9RGkYiAa7Pj17qjMCoLCyDd4', '6Wm1Q9LBdGLNM8yZhh6pc2JYVGDKf1oKkamayCmRAZWarEqc', '6YfJ2DoeU2jLT5vGRJknfRNMhDShuURC8UdzqvFYvxcv1zni', '6Y7rkEnYaWGDAPKWQKTKA67Dtt7PkVLfRrCgP4877B9rePEn', '6WPy6u7AJhT7yD5YsWDWcK5LSkQfcpDnGZeGB6L5rdXJStSC', '6YFCT2YqtpFGC3V9qaJNSdnHg66rBBSTpzJq68Njo5nwWdt4', '6VwrovpKiTss78eMeDwCwbDtB3yLf5kqamWyNExeGzpkEKqD', '6acM8N2jVzrNU1aQLhEkWTVLfkrw8hF2ktSYcYcJs8dHZ5Vu', '6YyrJszFjXHMzePDZrQMqqqWTLP2rCGQ2Yaw6JernpYxYq7h', '6Ze8pqYi4CAuwdm4eTGxKke7LSF6phkzmERUmpG5tTC1yKoh', '6WdBM7WosLcLrR13brm2fyUEhmF1m5hxHr4S1zVA6WcbgwBS']
commissions =  [0, 0.086, 0.08, 0.085, 0.0791, 0.07, 0.089, 0.085, 0.08, 0.09, 0.065, 0.08, 0.09, 0.0877, 0.09, 0.09, 0.065, 0.08, 0.09, 0.05, 0.085, 0.09, 0.082, 0.02, 0.091, 0.08, 0.08, 0.09, 0.091, 0.085, 0.09, 0.085, 0.092, 0.07, 0.09, 0.09, 0.084, 0.085, 0.0886, 0.055, 0.09, 0.09, 0.085, 0.065, 0.085, 0.07, 0.06, 0.0925, 0.08, 0.0936, 0.05, 0.085, 0, 0.094, 0.02, 0.04, 0.07, 0.092, 0.06, 0.085, 0.07, 0.07, 0.09, 0.095, 0.03, 0.095, 0.085, 0.09, 0.08, 0.09, 0.08, 0.093, 0.094, 0.07, 0.09, 0.086, 0.09, 0.08, 0.095, 0.08, 0.08, 0.07, 0.085, 0.092, 0.07, 0.08, 0.094, 0.095, 0.097, 0.095, 0.07, 0.07, 0.08, 0.09, 0.08, 0.09, 0.09, 0.03, 0.08, 0.08, 0.1, 0.09, 0.08, 0.05, 0.092, 0.08, 0.05, 0.095, 0.099, 0.08, 0.097, 0.07, 0.095, 0.07, 0.09, 0.1, 0.1, 0.08, 0.09, 0.07, 0.1]
pointWeights =  [0, 0.005182316861887717, 0.004959299737845984, 0.004786446947369629, 0.005253461647552071, 0.004754794777420997, 0.005121843794073015, 0.0034537163604040936, 0.005028847395668894, 0.005360832196529194, 0.00457308518709663, 0.005116181249907893, 0.005274151712770786, 0.005091280574925369, 0.005118286554789797, 0.00510935715822172, 0.004942312105350618, 0.0049373755283861525, 0.004999300530602167, 0.00476328859366868, 0.004932801935022015, 0.004859261457595494, 0.004804305740505783, 0.004984635993148902, 0.005198723720622558, 0.005284896027340506, 0.004711599728981925, 0.0048384987956567125, 0.005156182042664076, 0.0047616914658272355, 0.005069428962185603, 0.005023330044943903, 0.005253461647552071, 0.004871312513126395, 0.004943836636471997, 0.0049253244728552515, 0.004500415870310896, 0.004891421804584585, 0.005013674681175169, 0.004659838267575103, 0.004988991796352842, 0.004972367147457805, 0.0048164293927567495, 0.005090191624124384, 0.004911676289482906, 0.004664484457659306, 0.004551959541557521, 0.005200829025504462, 0.004794505183296918, 0.005011641973013331, 0.005196037641980128, 0.004920460492610852, 0.003882762975992192, 0.005345514288595339, 0.004999518320762364, 0.0035978934464545105, 0.00318111567655751, 0.0042873444969181605, 0.0049839826226683115, 0.00488880832266222, 0.0045961709440775125, 0.005103694614056598, 0.004627314936985684, 0.005109792738542114, 0.0047961023111383625, 0.005094039250287864, 0.004667460923181999, 0.004989499973393302, 0.004621652392820562, 0.004928881712138469, 0.005031751264471521, 0.005273353148850064, 0.0050908449946049745, 0.004825721772925155, 0.004080952021771466, 0.0050059794288482085, 0.004546514787552596, 0.004678640818072111, 0.004828843431887979, 0.005116253846627959, 0.005042785965921503, 0.004968955101614718, 0.003973145892473949, 0.005243443300183009, 0.0048628186968787115, 0.005011061199252806, 0.004896430978269115, 0.004535262295942417, 0.004948410229836134, 0.004866085549281666, 0.003436801324628793, 0.005315531843208218, 0.005052005749369842, 0.00483116652693008, 0.005081117034116176, 0.004803216789704798, 0.004966341619692354, 0.004741945157969374, 0.0046203456518593795, 0.004952185259279549, 0.00544453621476491, 0.0048769750572915166, 0.004163131508885802, 0.004746736541493708, 0.005120609649831898, 0.004101061313229656, 0.005425298083947507, 0.004842854598860653, 0.005013529487735038, 0.005425152890507376, 0.00450186780471221, 0.005220938316962652, 0.004791673911214356, 0.004239866241995213, 0.005138613636408184, 0.00525934198187739, 0.005230811470891583, 0.005096580135490162, 0.004844887307022492, 0.0036886393465365955, 0.005037196018476446]
stakedAmounts =  [0, 41980, 45000, 45000, 50991, 47099, 51208, 34999, 53145, 56171, 49332, 55000, 56650, 55125, 55999, 55999, 55999, 55939, 56154, 56000, 55971, 55000, 55000, 60935, 59167, 61000, 55500, 56484, 60167, 56763, 61000, 60847, 63160, 60000, 60000, 60000, 55800, 60858, 63161, 61000, 62999, 62899, 61526, 66472, 62994, 62721, 62700, 70412, 66457, 69120, 77070, 70415, 61000, 77000, 78596, 55600, 47684, 62970, 75981, 72550, 70343, 78511, 70003, 77000, 77617, 77361, 72413, 77000, 72694, 77000, 79525, 82645, 80000, 78517, 65000, 80108, 72696, 76162, 77809, 84411, 83920, 83990, 66473, 87307, 84000, 86111, 83150, 76999, 84000, 83000, 60609, 94079, 89000, 84602, 90000, 85000, 88840, 90628, 84026, 90184, 97979, 88888, 77037, 91031, 93924, 76699, 105000, 89600, 92809, 102556, 83680, 100167, 90000, 82000, 97901, 100202, 100000, 100000, 94718, 74076, 98450]

def getCC():
	cc = [0]
	for i in range(1, len(commissions)):
		cc.append(P * (1 - commissions[i]) * pointWeights[i])
	return cc

c = getCC()

def func(stake):
	funs = []
	stakes = 0
	for i in range(1, len(commissions)):
		funs.append(c[i] * stakedAmounts[i] / (stake[i] + stakedAmounts[i])**2 + stake[0])
		stakes = stakes + stake[i]
	funs.append(stakes - StakeLimit)
	return funs

op = [0]
average = StakeLimit / (len(commissions) - 1)
for i in range(1, len(commissions)):
	op.append(average)

root = fsolve(func, op)

print("===== 优化质押 =====")
total = 0
totalProfit = 0
for i in range(1, len(commissions)):
	total = total + root[i]
	profit = c[i] * root[i] / (stakedAmounts[i] + root[i])
	totalProfit = totalProfit + profit
	print("Stake: ", accounts[i], round(root[i]), "Profit: ", round(profit), "ARP: ", round(profit / root[i] * 100 * 365), "%")

print("Total Stake: ", round(total))
print("Total Profit: ", round(totalProfit))
print("Profit Rate: ", totalProfit / total * 100, "%", "ARP: ", totalProfit / total * 100 * 365, "%")

# 如果不做优化，平均stake
print()
print("===== 平均质押 =====")
total0 = 0
totalProfit0 = 0
for i in range(1, len(commissions)):
	total0 = total0 + average
	# print(i, c[i], average, stakedAmounts[i])
	profit0 = c[i] * average / (stakedAmounts[i] + average)
	totalProfit0 = totalProfit0 + profit0
	print("Stake: ", accounts[i], round(average), "Profit: ", round(profit0), "ARP: ", round(profit0 / average * 100 * 365), "%")

print("Total Stake: ", round(total0))
print("Total Profit: ", round(totalProfit0))
print("Profit Rate: ", totalProfit0 / total0 * 100, "%", "ARP: ", totalProfit0 / total0 * 100 * 365, "%")
print("Extra Profit: ", round(totalProfit - totalProfit0), (totalProfit - totalProfit0) / totalProfit0 * 100, "%")
