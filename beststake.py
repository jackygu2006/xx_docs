from scipy.optimize import fsolve
import math

P = 42000 # Total era reward
StakeLimit = 2000000 

accounts =  [0, '6WteLswxK1qpGhZH8tZ9Tw5w2pUQnUDwKLQjjb4tYLKsweS4', '6ZvBHAFW1Dzfr1hGFZRe6JLTcaRSo4ajEaw6EdFf1xDgpQSp', '6aF97WFzcP4dJZ8Bq8gaDy2cemGrTmtDaFSpPEPRaVnHT6C4', '6WXn2R5bqQFDKEfb7MMGWERV1b9VaCfcY6TUWt7zxD8Z3jjM', '6VKP5bVgJsn3jnrtfcjnKeCXtDM8ow5oqN1kdr5zD7cixwfR', '6VcywSjBKXQ1aXpeftzw92X1TXEe3MYPHDYDVKZheZpTzPeB', '6WwHRQgwFkmhzG3p8cvLPDoe39nkvb9877DnSZD2ddmzNBBk', '6aprZrw6imaLw1EfW6JCiJDctC1PPYMYie4xwPxzGfFAKraj', '6ZhrpbMadopQE7dhq4mKXzEBgsfMVAo39yds2UCpAVw2HSFP', '6WtLsbPkztf43vjrksuLEN4odtHmFNooB2CCYv3XpoYGnReM', '6YCLApJCrWo2b1i6ZLi2rmsLCDMnbh3QVgwNe5YMgoyNSxyY', '6aqDXrb72KWtP6rLxghK1PkrzGG13BVhpJY3v4jDZYwSAXjV', '6XLb1ZJrihTzUaZde6G6XEr91jnC3h3hJ3PVg1cuMaiBMwQD', '6XJ2rr88nBgUcvDtFoGQSiPvPYTzidZ5ZHbEDqwLyBx7dCs1', '6Y2EoZ3sikGTjS2paPwv7HMSRqKV8nqu9yDT6whPyYoBMKsy', '6WaWq6R8B3n7tVuzYj9uFS6ZJMbfmZqx97rcuYqHoPWLUx7L', '6aE7nMQXGbCUYVi4jcGKxS8VQUdWD7xZWvvc74pFA288xujP', '6Vm8ffQyYNj9zYgtzzXkmrcf9XiD57xUrVuPp8L47Q9rnPcH', '6YfTEcfUGXhcJibFCqtDAK3Eari5DUpe2X9FRS4sBwMhvFCS', '6VUsV1zjrnBJRgvRAEkbTTGUBJ4Km47uaAhADYsKE1mcoSru', '6WBJz51panWZaYe7Px2Tx8EwJxfAVTn7yTmeWgKMmTwZ4s4k', '6YEoe6N2K1yuiyXockNj6FdcP1dVzGFJGLKL3PWeX4r5EQnC', '6VgLbsTYK763mvcXv7Vpj8Qsj4ZkQAYohfRMaEE1wrA2SPw6', '6WuDKo1bZvbdZA8tZzwhUWetvc2ityj5P693JtCDYcFCyn7X', '6aKcuy2aoXA3s1f9JYXiWvY926nHtpEu9mMz4DMURFHNvHdZ', '6VfqjX9gf2bC2bvkvf7w5cGv9q1TGRGoTQTfX1Mud5W2uohS', '6YWZReaAAiT9p6aTXMVXxdLPkTehk7mspysz4XdjXEzez7KP', '6ZjtGawffFWrRttNBvYWmHv1Teg1Sa4twzmt8yPMDEkf7Ygr', '6X9tojfXMn9ipyRkETqB2ypEeWpUEfW6gejHpQQVnj9nmFJT', '6a4nBbr9D7r9rbY7kGmWvzjQAFqEAUeA26gQo8hmEf62wVuy', '6YbnK95QZBZ3dqe1kNj2kcAZ2toj6T5bypXAqsQANC21tviG', '6YfWhbcRqQahm4YnBbDZrq7gEZgdaCKY1A361nxQjuyY9wJ4', '6aqVm4B8mkNXPSmhquk95Eh8B23jnGFBkktmvHGPBLfvtLfY', '6Xz5sSwcyou3Js4a3W15cDQYwToVgRWQjvzePEBgonka7CmW', '6VqnEvPy2S6ngv2wEKEcjhz4J5UosEU2NuJNei16quqpvJ7T', '6axB72NzHf7VAu99cQ6UbqzJnSDjd4KrkNeXBuzqzeRMhRcA', '6VuHaSN6rTXy1PJSFYLqjpCkY3z9hokqyHFUyFwjZX3Jduu4', '6ayP5gSrLB4mKhZY59VEmqfYjn6pCaZ4anxXTqnCvvGyCwD2', '6ZRhphaxF54YXZxDuBkDJNt5xjULZfbYDSNqrM3GfT1VAmzw', '6XJZd6JNEzAJ88Bjbs9ZVLM6TbQ8VA3EZewbfaTzLwqtvw5m', '6XvrJTbymUn21UhXvpCdmrVhLxwtjVVGgr2j6fmRwnt9ZuYP', '6YnWGrtqHG73r8PEnNvKBtBjEjnjY9yyRXShQ6GpeqQ54wBv', '6Vu5Ba1ZDJjnjwnFJVCp6p3gTU9G4oCNq6DmJzNCYMBBvc4r', '6Ze8pqYi4CAuwdm4eTGxKke7LSF6phkzmERUmpG5tTC1yKoh', '6YjyZ9xyUbYZhWijVVBceUTQXsnNAYTAMr4WX8UiXjNC2rPe', '6X9un2FrLrS5gxx5mYWCCGg8cXcuoZRgnoRCs2TaHmEbnUUW', '6ZPVAr3yiu4xgZ6V9mTuEJNniJEiAMRVk8vzb9hCqceTWaZW', '6VV6VMPxKGCr6pJSp2r7ftvoMokRJGym79wqVGC8PDUfVWUQ', '6Wfy3CSuEFKxfgXKL7xS7AofsRxHQnjf48YFuMzKxjUAy8EA', '6XJT8hi5Hwx4yVcqNN6LqQZwc8tzhekZnjU2i1RL8Tbeine8', '6a9sP4NF21k1E2YaVDLaRGssuLMNTponrMdAzGaEbEcNWbZx', '6YeyBmoE7AWT9d87dhFxUJdH1FFLwHWQZGHdmB7pPUp6E4Sp', '6YyrJszFjXHMzePDZrQMqqqWTLP2rCGQ2Yaw6JernpYxYq7h', '6VquFJdMeRsZXFwnx4YHidKBS2A6pDubHq5bb59rjT458eMf', '6XfiFEW89LZiX7pFRihAVTk4odz4NJ4FgF5SfGHyQmMUSyvc', '6aByB8ZjvRm23bdTxXAdeYW2KnwkzdfPU5fhANicjjEnsENB', '6aTwvyJzgswbJgqEp4EGiNFckZDD1sL7TgNcxmtPWYTGyvnq', '6X3DCcMgAsorR3eJEHJFMbpLqzS3jnz8vpgS3js4Mu6mRaj7', '6WKFuHZJzi5zbFd4bgh76W1JPx5TigBmEJ4wkYnap93Yck8i', '6ae5jDdA8Li3rDxEtgRfExynwscbyfPgpoGmqHNphSfsbZpw', '6Z6vYyPVe9abGb2JVip5SCv4EDmiUFqojduwLqwfSn5YETqq', '6VxGEybRasAYhrATyM1Bh5yC3cJxwEVC4Y6uNRBqjKTjYz7c', '6aW6FtLkWVca7wfVjWR5AcnZGs1LG76mbdYUF64aPR3vouEn', '6ZZrf2cUrh5TBXU9BzRL7UEsWfxH4shQFfwqS5vjVHxJ235T', '6Z9KCWCuqN5jJNx88B9TJ34iw5fr72zNxcSQfw9HucJQcAFA', '6X5TE6TM4o8eyDvsB83zNnZnZUKRftX3MeAZDZbK18DoFS1F', '6a6Ti9ZzE7JQqvMx88MZB5atwiWCGwSSgpstqwHvG83CjUvm', '6WMpg7VNzJio9fGQNdMnsjHoMjtGnne4F7tC3drtyoBLV7vY', '6WCp6uTSoG45eXoqRG45RknWwGJWoutoNdLZEhTn8bRjGj1P', '6YvPxCto9QQwqgyBYz2JypN6ndDHcDc4irPDAJAQ6XutRgv3', '6YDQF9wcfH42Xb45wU52hnnRUAhDschVr1CsKX1Krbs2fw7g', '6XJmBPmTNySMHxeSyKxP1pWNfCr8JNfmyf41ybz8Srb6PZ6E', '6Xk5TiRpT2eFV7VHwtkR36e3j2D8s4c1mYDqk8RjjuxuM7Po', '6Z6nU2akS4vbuAmZ5uH2eKmDChwuVKShx5i5YoreP9aeq1Z3', '6YTxT1iyc7DPjpNXLPzijanR3zLeJoYqHv867ZwvmqUNQdpt', '6XvWxQui3647iReRzMEAe3hdPSMtV61C9hYxbaLnoPGM4fJ8', '6YF1HV5Y5k3STniw4GKqDufXVKWc57BGC443p1W3VS6MYrZ8', '6ZsqCoFPFyNABurKzkvc8vo2LPdr6fvfUtrjbsGZxN4gUSHA', '6WMsRFXaJVUjB1ufh74sYDVZkEktpfjE38zMV4KeiHU2fN3s', '6XUX2BaGnbzokxHby7hqb7RVNKKnYQCZAFFo7pNBUcnoAnQP', '6axWahYH28igVhwteB8s64xYcPaLUKUaCybQJHhATruvDKGe', '6ajYPHaqhxz5jSEpzJDh3ovWLrgdZ8Vu8HRMaWKAHXKwuRhg', '6Y7rkEnYaWGDAPKWQKTKA67Dtt7PkVLfRrCgP4877B9rePEn', '6Z6r4sUdJzURm8F135KRMaPtyPLk5J76NuWdSxh8ArR1jnaE', '6WPwdSYHvoSj9Ga6wrByz5byYx93o6nGXDPekXVX84LxkiGL', '6XqXfiGyAz4jPRaXdoaTWZJPsK9yMwdihc6CBBfWARh5dWr3', '6X7HD6Tyuh49X4NPy17V6Q1pERrGnHQrHJG3cPQu8bPRshBK', '6W7vwrpJd38G2x3HbnLcJst7LzPzJQ6etEjCcbByJzeMQjXE', '6X36bwZi9QfCTh1gFJBitwxvMxSHp3dcRhKNMKSRHMoEZntW', '6WkuzpX6Z3mataoeZYZ3Cdpk3XizX3526GxSKh1YrZFYoZ1U', '6Z2KEMk14tsmNJL9Gb5sCu4SXBcKYVWqwitXYMuADNQFfhYp', '6W5riDnAmZwNsoYwpytGepMzTvXfcHYeS1rLeZDTeL5KTtSH', '6VosbJXBD3fqpdaovAi1BVcHsPnRTmpCgRF9tqLVhMPG2z8y', '6XqPDHK6xw2ek2zewsWyoafaLzYpxJPn9D1RhKNnD2U3U2G3', '6Zerqx4FGws5Hn86vodryjiasr5grF9EKGWvaUPu9kCkL4bY', '6Ww4ixwUhXUrJW6BFnz1xkzmPJvsUGbgp486Q55TSDWp2Hin', '6Xcsq67Yvxh7ceGkuQ4J6HqtJnAD5siVpZQdnknx1UgBA3qr', '6XiK7tiHuJ5tWXtJJmhbWsS3h7ovdQYp38RQzY6wWqc2AWMQ', '6ZbmUc2MFHLp9wsxgJgPPx3r4GYqFETbWYCaQ484bADFntJB', '6Yv5aSM6DVPWcUqSG4bCAbZf9RZdx8awE9ANyeuFa5QHgZnk']
commissions =  [0, 0.085, 0.08, 0.084, 0.08, 0.085, 0.08, 0.08, 0.05, 0.08, 0.09, 0.087, 0.082, 0.09, 0.09, 0.085, 0.091, 0.09, 0.09, 0.091, 0.08, 0.092, 0.07, 0.09, 0.07, 0.09, 0.08, 0.092, 0.09, 0.055, 0.085, 0.09, 0.085, 0.085, 0.0886, 0.02, 0.09, 0.09, 0.065, 0.09, 0.085, 0.09, 0.085, 0.08, 0.07, 0.0936, 0.06, 0.07, 0.085, 0.085, 0.08, 0.07, 0.09, 0.09, 0.04, 0.07, 0.092, 0.093, 0.0868, 0.093, 0.08, 0.095, 0.085, 0.07, 0.09, 0.095, 0.07, 0.06, 0.093, 0.02, 0.05, 0.02, 0.092, 0.09, 0.094, 0.0791, 0.094, 0.08, 0.07, 0.09, 0.08, 0.094, 0.095, 0.07, 0.09, 0.08, 0.086, 0.09, 0.07, 0.03, 0.08, 0.095, 0.097, 0.065, 0.085, 0.095, 0.05, 0.05, 0.08, 0.099, 0.1]
pointWeights =  [0, 0.004898093047342965, 0.003923428553266019, 0.004326594108704478, 0.004541627576062318, 0.004071874448155493, 0.00441528875523234, 0.004902532218840856, 0.004736684771679649, 0.004845266906518062, 0.004910256377247187, 0.004302178665466078, 0.004739792191728172, 0.004838696932701184, 0.004886018500868701, 0.004772908411102439, 0.005042987605034127, 0.004754707807961086, 0.004780011085499064, 0.005064295628224004, 0.004574211094856838, 0.0052133630071231835, 0.004866752496567855, 0.004899247231932417, 0.004688475369212552, 0.0044452975545580834, 0.004674358803849259, 0.005092706325810506, 0.004754086323951381, 0.0046040423273226655, 0.004894985627294441, 0.004713068379310868, 0.0048132160883032895, 0.004736329637959817, 0.004732867084191462, 0.004901111683961531, 0.004659176837326471, 0.0049526060733370665, 0.0044632318074095635, 0.0046031544930230876, 0.004872168285795281, 0.004027926650326372, 0.004851925663764899, 0.004743343528926485, 0.004559206695193966, 0.0048856633671488705, 0.004944881914930736, 0.004747072432984713, 0.004772553277382608, 0.004941774494882212, 0.005051599597740036, 0.0040978879931331345, 0.004665569244283435, 0.004870658967485998, 0.0035092538525127886, 0.004683237146845041, 0.004158970992944115, 0.004619668210995242, 0.004871102884635788, 0.004838608149271226, 0.0045058478537893165, 0.0050354410134877126, 0.004778146633469951, 0.004633695992928577, 0.00496183955005268, 0.004944082864061116, 0.004604397461042497, 0.004727806428683866, 0.0044997217971222275, 0.005210166803644702, 0.00479892195608008, 0.004634051126648409, 0.004401704890448794, 0.004346304030155114, 0.004982881222952683, 0.005132392519001652, 0.004726829810954331, 0.004599248022104943, 0.005015819875467034, 0.003943493608436485, 0.004975956115415973, 0.0049221533568615345, 0.004611411352009164, 0.0047280727789737395, 0.004491820071855981, 0.0043942470823323376, 0.004702591934575845, 0.004855210650673338, 0.004664681409983856, 0.004707918940373315, 0.004903420053140434, 0.004305818786094349, 0.004755595642260664, 0.0050096938187999445, 0.003642961698029265, 0.004871280451495703, 0.004675512988438711, 0.00480868813337544, 0.004762431966367416, 0.005037127898656911, 0.00525056326427551]
stakedAmounts =  [0, 34999, 35009, 41875, 45000, 45001, 49116, 56321, 56290, 55939, 56171, 49440, 55290, 55999, 56650, 56008, 59167, 56124, 56626, 60344, 55824, 63044, 60289, 60000, 60000, 55999, 59666, 64336, 60320, 61000, 62994, 61000, 62773, 63146, 63331, 71004, 63239, 67270, 62665, 62999, 67068, 55168, 67265, 66624, 66040, 69120, 73678, 70226, 69765, 73388, 75936, 62751, 70003, 73106, 55600, 72294, 62970, 69978, 74740, 74004, 70499, 77538, 74465, 73779, 77575, 77000, 73883, 76699, 70509, 89372, 79876, 79999, 70412, 70007, 80000, 84098, 77000, 76329, 84441, 65000, 84411, 83150, 77977, 82232, 77000, 77190, 82174, 84602, 83990, 89419, 89000, 76999, 85000, 93368, 66732, 89600, 91031, 93814, 90000, 93704, 97979]

def getCC():
	cc = [0]
	for i in range(1, len(commissions)):
		cc.append(P * (1 - commissions[i]) * pointWeights[i])
	return cc

c = getCC()

def func(stake):
	funs = []
	stakes = 0
	for i in range(1, len(commissions)):
		funs.append(c[i] * stakedAmounts[i] / (stake[i] + stakedAmounts[i])**2 + stake[0])
		stakes = stakes + stake[i]
	funs.append(stakes - StakeLimit)
	return funs

op = [0]
average = StakeLimit / (len(commissions) - 1)
for i in range(1, len(commissions)):
	op.append(average)

root = fsolve(func, op)

print("===== 优化质押 =====")
total = 0
totalProfit = 0
for i in range(1, len(commissions)):
	total = total + root[i]
	profit = c[i] * root[i] / (stakedAmounts[i] + root[i])
	totalProfit = totalProfit + profit
	print("Stake: ", accounts[i], round(root[i]), "Profit: ", round(profit), "ARP: ", round(profit / root[i] * 100 * 365), "%")

print("Total Stake: ", round(total))
print("Total Profit: ", round(totalProfit))
print("Profit Rate: ", totalProfit / total * 100, "%", "ARP: ", totalProfit / total * 100 * 365, "%")

# 如果不做优化，平均stake
print()
print("===== 平均质押 =====")
total0 = 0
totalProfit0 = 0
for i in range(1, len(commissions)):
	total0 = total0 + average
	# print(i, c[i], average, stakedAmounts[i])
	profit0 = c[i] * average / (stakedAmounts[i] + average)
	totalProfit0 = totalProfit0 + profit0
	print("Stake: ", accounts[i], round(average), "Profit: ", round(profit0), "ARP: ", round(profit0 / average * 100 * 365), "%")

print("Total Stake: ", round(total0))
print("Total Profit: ", round(totalProfit0))
print("Profit Rate: ", totalProfit0 / total0 * 100, "%", "ARP: ", totalProfit0 / total0 * 100 * 365, "%")
print("Extra Profit: ", round(totalProfit - totalProfit0), (totalProfit - totalProfit0) / totalProfit0 * 100, "%")
