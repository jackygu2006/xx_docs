from scipy.optimize import fsolve
import math

P = 42000 # Total era reward
StakeLimit = 2000000 

accounts =  [0, '6WteLswxK1qpGhZH8tZ9Tw5w2pUQnUDwKLQjjb4tYLKsweS4', '6ZvBHAFW1Dzfr1hGFZRe6JLTcaRSo4ajEaw6EdFf1xDgpQSp', '6aF97WFzcP4dJZ8Bq8gaDy2cemGrTmtDaFSpPEPRaVnHT6C4', '6WXn2R5bqQFDKEfb7MMGWERV1b9VaCfcY6TUWt7zxD8Z3jjM', '6VKP5bVgJsn3jnrtfcjnKeCXtDM8ow5oqN1kdr5zD7cixwfR', '6VcywSjBKXQ1aXpeftzw92X1TXEe3MYPHDYDVKZheZpTzPeB', '6YCLApJCrWo2b1i6ZLi2rmsLCDMnbh3QVgwNe5YMgoyNSxyY', '6WwHRQgwFkmhzG3p8cvLPDoe39nkvb9877DnSZD2ddmzNBBk', '6aprZrw6imaLw1EfW6JCiJDctC1PPYMYie4xwPxzGfFAKraj', '6ZhrpbMadopQE7dhq4mKXzEBgsfMVAo39yds2UCpAVw2HSFP', '6WtLsbPkztf43vjrksuLEN4odtHmFNooB2CCYv3XpoYGnReM', '6aqDXrb72KWtP6rLxghK1PkrzGG13BVhpJY3v4jDZYwSAXjV', '6XLb1ZJrihTzUaZde6G6XEr91jnC3h3hJ3PVg1cuMaiBMwQD', '6Y2EoZ3sikGTjS2paPwv7HMSRqKV8nqu9yDT6whPyYoBMKsy', '6aE7nMQXGbCUYVi4jcGKxS8VQUdWD7xZWvvc74pFA288xujP', '6WaWq6R8B3n7tVuzYj9uFS6ZJMbfmZqx97rcuYqHoPWLUx7L', '6XJ2rr88nBgUcvDtFoGQSiPvPYTzidZ5ZHbEDqwLyBx7dCs1', '6Vm8ffQyYNj9zYgtzzXkmrcf9XiD57xUrVuPp8L47Q9rnPcH', '6YEoe6N2K1yuiyXockNj6FdcP1dVzGFJGLKL3PWeX4r5EQnC', '6VUsV1zjrnBJRgvRAEkbTTGUBJ4Km47uaAhADYsKE1mcoSru', '6YfTEcfUGXhcJibFCqtDAK3Eari5DUpe2X9FRS4sBwMhvFCS', '6WBJz51panWZaYe7Px2Tx8EwJxfAVTn7yTmeWgKMmTwZ4s4k', '6WuDKo1bZvbdZA8tZzwhUWetvc2ityj5P693JtCDYcFCyn7X', '6VgLbsTYK763mvcXv7Vpj8Qsj4ZkQAYohfRMaEE1wrA2SPw6', '6aKcuy2aoXA3s1f9JYXiWvY926nHtpEu9mMz4DMURFHNvHdZ', '6X9tojfXMn9ipyRkETqB2ypEeWpUEfW6gejHpQQVnj9nmFJT', '6VfqjX9gf2bC2bvkvf7w5cGv9q1TGRGoTQTfX1Mud5W2uohS', '6YWZReaAAiT9p6aTXMVXxdLPkTehk7mspysz4XdjXEzez7KP', '6ZjtGawffFWrRttNBvYWmHv1Teg1Sa4twzmt8yPMDEkf7Ygr', '6YbnK95QZBZ3dqe1kNj2kcAZ2toj6T5bypXAqsQANC21tviG', '6a4nBbr9D7r9rbY7kGmWvzjQAFqEAUeA26gQo8hmEf62wVuy', '6YfWhbcRqQahm4YnBbDZrq7gEZgdaCKY1A361nxQjuyY9wJ4', '6aqVm4B8mkNXPSmhquk95Eh8B23jnGFBkktmvHGPBLfvtLfY', '6Xz5sSwcyou3Js4a3W15cDQYwToVgRWQjvzePEBgonka7CmW', '6axB72NzHf7VAu99cQ6UbqzJnSDjd4KrkNeXBuzqzeRMhRcA', '6VqnEvPy2S6ngv2wEKEcjhz4J5UosEU2NuJNei16quqpvJ7T', '6ZRhphaxF54YXZxDuBkDJNt5xjULZfbYDSNqrM3GfT1VAmzw', '6ayP5gSrLB4mKhZY59VEmqfYjn6pCaZ4anxXTqnCvvGyCwD2', '6XJZd6JNEzAJ88Bjbs9ZVLM6TbQ8VA3EZewbfaTzLwqtvw5m', '6XvrJTbymUn21UhXvpCdmrVhLxwtjVVGgr2j6fmRwnt9ZuYP', '6VuHaSN6rTXy1PJSFYLqjpCkY3z9hokqyHFUyFwjZX3Jduu4', '6YnWGrtqHG73r8PEnNvKBtBjEjnjY9yyRXShQ6GpeqQ54wBv', '6Vu5Ba1ZDJjnjwnFJVCp6p3gTU9G4oCNq6DmJzNCYMBBvc4r', '6Ze8pqYi4CAuwdm4eTGxKke7LSF6phkzmERUmpG5tTC1yKoh', '6X9un2FrLrS5gxx5mYWCCGg8cXcuoZRgnoRCs2TaHmEbnUUW', '6YjyZ9xyUbYZhWijVVBceUTQXsnNAYTAMr4WX8UiXjNC2rPe', '6ZPVAr3yiu4xgZ6V9mTuEJNniJEiAMRVk8vzb9hCqceTWaZW', '6a9sP4NF21k1E2YaVDLaRGssuLMNTponrMdAzGaEbEcNWbZx', '6VV6VMPxKGCr6pJSp2r7ftvoMokRJGym79wqVGC8PDUfVWUQ', '6Wfy3CSuEFKxfgXKL7xS7AofsRxHQnjf48YFuMzKxjUAy8EA', '6XJT8hi5Hwx4yVcqNN6LqQZwc8tzhekZnjU2i1RL8Tbeine8', '6YeyBmoE7AWT9d87dhFxUJdH1FFLwHWQZGHdmB7pPUp6E4Sp', '6XfiFEW89LZiX7pFRihAVTk4odz4NJ4FgF5SfGHyQmMUSyvc', '6aTwvyJzgswbJgqEp4EGiNFckZDD1sL7TgNcxmtPWYTGyvnq', '6VquFJdMeRsZXFwnx4YHidKBS2A6pDubHq5bb59rjT458eMf', '6YyrJszFjXHMzePDZrQMqqqWTLP2rCGQ2Yaw6JernpYxYq7h', '6aByB8ZjvRm23bdTxXAdeYW2KnwkzdfPU5fhANicjjEnsENB', '6X3DCcMgAsorR3eJEHJFMbpLqzS3jnz8vpgS3js4Mu6mRaj7', '6WKFuHZJzi5zbFd4bgh76W1JPx5TigBmEJ4wkYnap93Yck8i', '6ae5jDdA8Li3rDxEtgRfExynwscbyfPgpoGmqHNphSfsbZpw', '6VxGEybRasAYhrATyM1Bh5yC3cJxwEVC4Y6uNRBqjKTjYz7c', '6ZZrf2cUrh5TBXU9BzRL7UEsWfxH4shQFfwqS5vjVHxJ235T', '6Z6vYyPVe9abGb2JVip5SCv4EDmiUFqojduwLqwfSn5YETqq', '6aW6FtLkWVca7wfVjWR5AcnZGs1LG76mbdYUF64aPR3vouEn', '6X5TE6TM4o8eyDvsB83zNnZnZUKRftX3MeAZDZbK18DoFS1F', '6WMpg7VNzJio9fGQNdMnsjHoMjtGnne4F7tC3drtyoBLV7vY', '6a6Ti9ZzE7JQqvMx88MZB5atwiWCGwSSgpstqwHvG83CjUvm', '6Z9KCWCuqN5jJNx88B9TJ34iw5fr72zNxcSQfw9HucJQcAFA', '6Z6nU2akS4vbuAmZ5uH2eKmDChwuVKShx5i5YoreP9aeq1Z3', '6WCp6uTSoG45eXoqRG45RknWwGJWoutoNdLZEhTn8bRjGj1P', '6YDQF9wcfH42Xb45wU52hnnRUAhDschVr1CsKX1Krbs2fw7g', '6YvPxCto9QQwqgyBYz2JypN6ndDHcDc4irPDAJAQ6XutRgv3', '6Xk5TiRpT2eFV7VHwtkR36e3j2D8s4c1mYDqk8RjjuxuM7Po', '6YF1HV5Y5k3STniw4GKqDufXVKWc57BGC443p1W3VS6MYrZ8', '6YTxT1iyc7DPjpNXLPzijanR3zLeJoYqHv867ZwvmqUNQdpt', '6WMsRFXaJVUjB1ufh74sYDVZkEktpfjE38zMV4KeiHU2fN3s', '6XvWxQui3647iReRzMEAe3hdPSMtV61C9hYxbaLnoPGM4fJ8', '6ZsqCoFPFyNABurKzkvc8vo2LPdr6fvfUtrjbsGZxN4gUSHA', '6axWahYH28igVhwteB8s64xYcPaLUKUaCybQJHhATruvDKGe', '6ajYPHaqhxz5jSEpzJDh3ovWLrgdZ8Vu8HRMaWKAHXKwuRhg', '6Z6r4sUdJzURm8F135KRMaPtyPLk5J76NuWdSxh8ArR1jnaE', '6XUX2BaGnbzokxHby7hqb7RVNKKnYQCZAFFo7pNBUcnoAnQP', '6Y7rkEnYaWGDAPKWQKTKA67Dtt7PkVLfRrCgP4877B9rePEn', '6WPwdSYHvoSj9Ga6wrByz5byYx93o6nGXDPekXVX84LxkiGL', '6XqXfiGyAz4jPRaXdoaTWZJPsK9yMwdihc6CBBfWARh5dWr3', '6W7vwrpJd38G2x3HbnLcJst7LzPzJQ6etEjCcbByJzeMQjXE', '6X7HD6Tyuh49X4NPy17V6Q1pERrGnHQrHJG3cPQu8bPRshBK', '6XqPDHK6xw2ek2zewsWyoafaLzYpxJPn9D1RhKNnD2U3U2G3', '6X36bwZi9QfCTh1gFJBitwxvMxSHp3dcRhKNMKSRHMoEZntW', '6Z2KEMk14tsmNJL9Gb5sCu4SXBcKYVWqwitXYMuADNQFfhYp', '6WkuzpX6Z3mataoeZYZ3Cdpk3XizX3526GxSKh1YrZFYoZ1U', '6W5riDnAmZwNsoYwpytGepMzTvXfcHYeS1rLeZDTeL5KTtSH', '6VosbJXBD3fqpdaovAi1BVcHsPnRTmpCgRF9tqLVhMPG2z8y', '6Zerqx4FGws5Hn86vodryjiasr5grF9EKGWvaUPu9kCkL4bY', '6XJmBPmTNySMHxeSyKxP1pWNfCr8JNfmyf41ybz8Srb6PZ6E', '6XiK7tiHuJ5tWXtJJmhbWsS3h7ovdQYp38RQzY6wWqc2AWMQ', '6Ww4ixwUhXUrJW6BFnz1xkzmPJvsUGbgp486Q55TSDWp2Hin', '6Xcsq67Yvxh7ceGkuQ4J6HqtJnAD5siVpZQdnknx1UgBA3qr', '6ZbmUc2MFHLp9wsxgJgPPx3r4GYqFETbWYCaQ484bADFntJB', '6a3paYochic4YVwoGxu8PNdZWaHLvF8CAGP3W5x8BHZeJ4RA']
commissions =  [0, 0.085, 0.08, 0.084, 0.08, 0.085, 0.08, 0.087, 0.08, 0.05, 0.08, 0.09, 0.082, 0.09, 0.085, 0.09, 0.091, 0.09, 0.09, 0.07, 0.08, 0.091, 0.092, 0.07, 0.09, 0.09, 0.055, 0.08, 0.092, 0.09, 0.09, 0.085, 0.085, 0.085, 0.0886, 0.09, 0.02, 0.09, 0.065, 0.085, 0.09, 0.09, 0.085, 0.08, 0.07, 0.06, 0.0936, 0.07, 0.07, 0.085, 0.085, 0.08, 0.09, 0.07, 0.093, 0.04, 0.09, 0.092, 0.0868, 0.093, 0.08, 0.085, 0.09, 0.095, 0.07, 0.07, 0.093, 0.06, 0.095, 0.094, 0.02, 0.02, 0.05, 0.09, 0.08, 0.0791, 0.09, 0.094, 0.07, 0.094, 0.095, 0.09, 0.08, 0.07, 0.08, 0.086, 0.07, 0.09, 0.085, 0.03, 0.095, 0.08, 0.097, 0.065, 0.095, 0.092, 0.08, 0.05, 0.05, 0.099, 0.03]
pointWeights =  [0, 0.004917217739370274, 0.004125696133491201, 0.004470766689791972, 0.004610664232931821, 0.004154866580255813, 0.00446345523414296, 0.004360491848405334, 0.004897393895703366, 0.004716944155252504, 0.004812746837003986, 0.004872293743836142, 0.004716868779421071, 0.004815611118598444, 0.004774983545455998, 0.004805736884680707, 0.005055984645038627, 0.004817495514384271, 0.004751767789374601, 0.004892343714997348, 0.0045633282107918295, 0.004989578537546059, 0.0051743247003886075, 0.004799782193997491, 0.004884127749371139, 0.004481093178698307, 0.004667422234000952, 0.004665462462383692, 0.005052215853466972, 0.0047264415100130765, 0.004739180025525272, 0.0048150081119469786, 0.004792018483359881, 0.004770460995570012, 0.00479345062415711, 0.004740913669648233, 0.004892419090828781, 0.00465792487924038, 0.004499108002410821, 0.004915710222741612, 0.0040602699118072625, 0.004944880669506225, 0.004854354295955062, 0.004732923831516324, 0.004601920636485581, 0.0050204072526022, 0.004839957512151338, 0.004736164992267947, 0.004208458796404754, 0.00472410485923865, 0.0049496293468865105, 0.005084099830163177, 0.004684004916916236, 0.004709255820446327, 0.004655362100971654, 0.0034923883977902217, 0.004843726303722993, 0.0041324045824887475, 0.004868449576433053, 0.004843047921240095, 0.004526695556715339, 0.0047771694445675585, 0.004999980402283827, 0.005012794293627456, 0.004624081130926915, 0.004602297515642746, 0.004487726251864421, 0.004695462043294069, 0.0048877457892799285, 0.005046261162783756, 0.005189550618338095, 0.004641719075482262, 0.004764732432381095, 0.004311874437130978, 0.004647070759514013, 0.005092315795789386, 0.003972607819850557, 0.004726215382518777, 0.004987618765928798, 0.004971865217159278, 0.004653025450197228, 0.004564534224094759, 0.004931840650668297, 0.004739481528851004, 0.0044304406199752585, 0.0047284766574617705, 0.004747320615320048, 0.004851640766023469, 0.003761027861017821, 0.004731190187393362, 0.0043629792508426265, 0.00493771996552008, 0.004768501223952751, 0.004965835150644629, 0.004870107844724581, 0.0038055749773947883, 0.004796164154088701, 0.004672924669695569, 0.004808073535455133, 0.005034276405585892, 0.004506796337216998]
stakedAmounts =  [0, 34999, 35009, 41875, 45000, 45001, 49116, 49440, 56321, 56290, 55939, 56171, 55290, 55999, 56008, 56124, 59167, 56650, 56626, 60289, 55824, 60344, 63044, 60000, 60000, 55999, 61000, 59666, 64336, 60320, 61000, 62994, 62773, 63146, 63331, 63239, 71004, 62999, 62665, 67068, 55168, 67270, 67265, 66624, 66040, 73678, 69120, 70226, 62751, 69765, 73388, 75936, 70003, 72294, 69978, 55600, 73106, 62970, 74740, 74004, 70499, 74465, 77575, 77538, 73779, 73883, 70509, 76699, 77000, 80000, 89372, 79999, 79876, 70007, 76329, 84098, 65000, 77000, 84441, 83150, 77977, 77000, 84411, 82232, 77190, 82174, 83990, 84602, 66732, 89419, 76999, 89000, 85000, 93368, 89600, 70412, 90000, 91031, 93814, 93704, 90375]

def getCC():
	cc = [0]
	for i in range(1, len(commissions)):
		cc.append(P * (1 - commissions[i]) * pointWeights[i])
	return cc

c = getCC()

def func(stake):
	funs = []
	stakes = 0
	for i in range(1, len(commissions)):
		funs.append(c[i] * stakedAmounts[i] / (stake[i] + stakedAmounts[i])**2 + stake[0])
		stakes = stakes + stake[i]
	funs.append(stakes - StakeLimit)
	return funs

op = [0]
average = StakeLimit / (len(commissions) - 1)
for i in range(1, len(commissions)):
	op.append(average)

root = fsolve(func, op)

print("===== 优化质押 =====")
total = 0
totalProfit = 0
for i in range(1, len(commissions)):
	total = total + root[i]
	profit = c[i] * root[i] / (stakedAmounts[i] + root[i])
	totalProfit = totalProfit + profit
	print("Stake: ", accounts[i], round(root[i]), "Profit: ", round(profit), "ARP: ", round(profit / root[i] * 100 * 365), "%")

print("Total Stake: ", round(total))
print("Total Profit: ", round(totalProfit))
print("Profit Rate: ", totalProfit / total * 100, "%", "ARP: ", totalProfit / total * 100 * 365, "%")

# 如果不做优化，平均stake
print()
print("===== 平均质押 =====")
total0 = 0
totalProfit0 = 0
for i in range(1, len(commissions)):
	total0 = total0 + average
	# print(i, c[i], average, stakedAmounts[i])
	profit0 = c[i] * average / (stakedAmounts[i] + average)
	totalProfit0 = totalProfit0 + profit0
	print("Stake: ", accounts[i], round(average), "Profit: ", round(profit0), "ARP: ", round(profit0 / average * 100 * 365), "%")

print("Total Stake: ", round(total0))
print("Total Profit: ", round(totalProfit0))
print("Profit Rate: ", totalProfit0 / total0 * 100, "%", "ARP: ", totalProfit0 / total0 * 100 * 365, "%")
print("Extra Profit: ", round(totalProfit - totalProfit0), (totalProfit - totalProfit0) / totalProfit0 * 100, "%")
