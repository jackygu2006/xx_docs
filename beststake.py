from scipy.optimize import fsolve
import math

P = 42000 # Total era reward
StakeLimit = 2000000 

accounts =  [0, '6YjhkzRCcQvYXTJi7EP1mKzFXm9h6Ct65v4B1ugw4f7rnJxE', '6WXn2R5bqQFDKEfb7MMGWERV1b9VaCfcY6TUWt7zxD8Z3jjM', '6VKP5bVgJsn3jnrtfcjnKeCXtDM8ow5oqN1kdr5zD7cixwfR', '6YTxT1iyc7DPjpNXLPzijanR3zLeJoYqHv867ZwvmqUNQdpt', '6VV6VMPxKGCr6pJSp2r7ftvoMokRJGym79wqVGC8PDUfVWUQ', '6WteLswxK1qpGhZH8tZ9Tw5w2pUQnUDwKLQjjb4tYLKsweS4', '6Y2dskdRsFxSobeeB76pDenbzW98eaiF1A4bBQtFMrv4YDnX', '6VfqjX9gf2bC2bvkvf7w5cGv9q1TGRGoTQTfX1Mud5W2uohS', '6ayP5gSrLB4mKhZY59VEmqfYjn6pCaZ4anxXTqnCvvGyCwD2', '6WtLsbPkztf43vjrksuLEN4odtHmFNooB2CCYv3XpoYGnReM', '6WwHRQgwFkmhzG3p8cvLPDoe39nkvb9877DnSZD2ddmzNBBk', '6WkVhnWVaavwAtPbjCrSNCMnXj7Fj1XHAEwuNuPr2CdNMssG', '6XJ2rr88nBgUcvDtFoGQSiPvPYTzidZ5ZHbEDqwLyBx7dCs1', '6XLb1ZJrihTzUaZde6G6XEr91jnC3h3hJ3PVg1cuMaiBMwQD', '6VosbJXBD3fqpdaovAi1BVcHsPnRTmpCgRF9tqLVhMPG2z8y', '6ZhrpbMadopQE7dhq4mKXzEBgsfMVAo39yds2UCpAVw2HSFP', '6aprZrw6imaLw1EfW6JCiJDctC1PPYMYie4xwPxzGfFAKraj', '6Y2EoZ3sikGTjS2paPwv7HMSRqKV8nqu9yDT6whPyYoBMKsy', '6aE7nMQXGbCUYVi4jcGKxS8VQUdWD7xZWvvc74pFA288xujP', '6aKcuy2aoXA3s1f9JYXiWvY926nHtpEu9mMz4DMURFHNvHdZ', '6aqDXrb72KWtP6rLxghK1PkrzGG13BVhpJY3v4jDZYwSAXjV', '6VqnEvPy2S6ngv2wEKEcjhz4J5UosEU2NuJNei16quqpvJ7T', '6WaWq6R8B3n7tVuzYj9uFS6ZJMbfmZqx97rcuYqHoPWLUx7L', '6VapwtSYE3q6Ea3JLz7krezamf5J7fZpxunDwQK2ja4zC4BC', '6YfTEcfUGXhcJibFCqtDAK3Eari5DUpe2X9FRS4sBwMhvFCS', '6XvrJTbymUn21UhXvpCdmrVhLxwtjVVGgr2j6fmRwnt9ZuYP', '6VUsV1zjrnBJRgvRAEkbTTGUBJ4Km47uaAhADYsKE1mcoSru', '6Vm8ffQyYNj9zYgtzzXkmrcf9XiD57xUrVuPp8L47Q9rnPcH', '6aqVm4B8mkNXPSmhquk95Eh8B23jnGFBkktmvHGPBLfvtLfY', '6YnWGrtqHG73r8PEnNvKBtBjEjnjY9yyRXShQ6GpeqQ54wBv', '6WBJz51panWZaYe7Px2Tx8EwJxfAVTn7yTmeWgKMmTwZ4s4k', '6YbnK95QZBZ3dqe1kNj2kcAZ2toj6T5bypXAqsQANC21tviG', '6YEoe6N2K1yuiyXockNj6FdcP1dVzGFJGLKL3PWeX4r5EQnC', '6VgLbsTYK763mvcXv7Vpj8Qsj4ZkQAYohfRMaEE1wrA2SPw6', '6ZjtGawffFWrRttNBvYWmHv1Teg1Sa4twzmt8yPMDEkf7Ygr', '6aF97WFzcP4dJZ8Bq8gaDy2cemGrTmtDaFSpPEPRaVnHT6C4', '6XJZd6JNEzAJ88Bjbs9ZVLM6TbQ8VA3EZewbfaTzLwqtvw5m', '6Xz5sSwcyou3Js4a3W15cDQYwToVgRWQjvzePEBgonka7CmW', '6X9tojfXMn9ipyRkETqB2ypEeWpUEfW6gejHpQQVnj9nmFJT', '6ZRhphaxF54YXZxDuBkDJNt5xjULZfbYDSNqrM3GfT1VAmzw', '6axB72NzHf7VAu99cQ6UbqzJnSDjd4KrkNeXBuzqzeRMhRcA', '6VuHaSN6rTXy1PJSFYLqjpCkY3z9hokqyHFUyFwjZX3Jduu4', '6a4nBbr9D7r9rbY7kGmWvzjQAFqEAUeA26gQo8hmEf62wVuy', '6YfWhbcRqQahm4YnBbDZrq7gEZgdaCKY1A361nxQjuyY9wJ4', '6a9sP4NF21k1E2YaVDLaRGssuLMNTponrMdAzGaEbEcNWbZx', '6a6Ti9ZzE7JQqvMx88MZB5atwiWCGwSSgpstqwHvG83CjUvm', '6XJmBPmTNySMHxeSyKxP1pWNfCr8JNfmyf41ybz8Srb6PZ6E', '6Vu5Ba1ZDJjnjwnFJVCp6p3gTU9G4oCNq6DmJzNCYMBBvc4r', '6YjyZ9xyUbYZhWijVVBceUTQXsnNAYTAMr4WX8UiXjNC2rPe', '6VxGEybRasAYhrATyM1Bh5yC3cJxwEVC4Y6uNRBqjKTjYz7c', '6YvPxCto9QQwqgyBYz2JypN6ndDHcDc4irPDAJAQ6XutRgv3', '6XfiFEW89LZiX7pFRihAVTk4odz4NJ4FgF5SfGHyQmMUSyvc', '6XvWxQui3647iReRzMEAe3hdPSMtV61C9hYxbaLnoPGM4fJ8', '6WCp6uTSoG45eXoqRG45RknWwGJWoutoNdLZEhTn8bRjGj1P', '6aByB8ZjvRm23bdTxXAdeYW2KnwkzdfPU5fhANicjjEnsENB', '6VquFJdMeRsZXFwnx4YHidKBS2A6pDubHq5bb59rjT458eMf', '6Wfy3CSuEFKxfgXKL7xS7AofsRxHQnjf48YFuMzKxjUAy8EA', '6X9un2FrLrS5gxx5mYWCCGg8cXcuoZRgnoRCs2TaHmEbnUUW', '6WMpg7VNzJio9fGQNdMnsjHoMjtGnne4F7tC3drtyoBLV7vY', '6ZPVAr3yiu4xgZ6V9mTuEJNniJEiAMRVk8vzb9hCqceTWaZW', '6YeyBmoE7AWT9d87dhFxUJdH1FFLwHWQZGHdmB7pPUp6E4Sp', '6X36bwZi9QfCTh1gFJBitwxvMxSHp3dcRhKNMKSRHMoEZntW', '6Z9KCWCuqN5jJNx88B9TJ34iw5fr72zNxcSQfw9HucJQcAFA', '6Z6vYyPVe9abGb2JVip5SCv4EDmiUFqojduwLqwfSn5YETqq', '6X3DCcMgAsorR3eJEHJFMbpLqzS3jnz8vpgS3js4Mu6mRaj7', '6ZZrf2cUrh5TBXU9BzRL7UEsWfxH4shQFfwqS5vjVHxJ235T', '6ae5jDdA8Li3rDxEtgRfExynwscbyfPgpoGmqHNphSfsbZpw', '6XJT8hi5Hwx4yVcqNN6LqQZwc8tzhekZnjU2i1RL8Tbeine8', '6Z6r4sUdJzURm8F135KRMaPtyPLk5J76NuWdSxh8ArR1jnaE', '6WKFuHZJzi5zbFd4bgh76W1JPx5TigBmEJ4wkYnap93Yck8i', '6Z6nU2akS4vbuAmZ5uH2eKmDChwuVKShx5i5YoreP9aeq1Z3', '6Xk5TiRpT2eFV7VHwtkR36e3j2D8s4c1mYDqk8RjjuxuM7Po', '6XqXfiGyAz4jPRaXdoaTWZJPsK9yMwdihc6CBBfWARh5dWr3', '6aTwvyJzgswbJgqEp4EGiNFckZDD1sL7TgNcxmtPWYTGyvnq', '6WMsRFXaJVUjB1ufh74sYDVZkEktpfjE38zMV4KeiHU2fN3s', '6YF1HV5Y5k3STniw4GKqDufXVKWc57BGC443p1W3VS6MYrZ8', '6ajYPHaqhxz5jSEpzJDh3ovWLrgdZ8Vu8HRMaWKAHXKwuRhg', '6XUX2BaGnbzokxHby7hqb7RVNKKnYQCZAFFo7pNBUcnoAnQP', '6W7vwrpJd38G2x3HbnLcJst7LzPzJQ6etEjCcbByJzeMQjXE', '6VSduRsfo5nnZW4aafVvE8wdSq8tpuSTLWxqT1STqRcqy2kg', '6YWZReaAAiT9p6aTXMVXxdLPkTehk7mspysz4XdjXEzez7KP', '6ZsqCoFPFyNABurKzkvc8vo2LPdr6fvfUtrjbsGZxN4gUSHA', '6Z2KEMk14tsmNJL9Gb5sCu4SXBcKYVWqwitXYMuADNQFfhYp', '6agYSwtSM4AVwxBjVDaVcC9SVwUZa9a6xcZERLoYdJHJVH2T', '6axWahYH28igVhwteB8s64xYcPaLUKUaCybQJHhATruvDKGe', '6X5TE6TM4o8eyDvsB83zNnZnZUKRftX3MeAZDZbK18DoFS1F', '6XtJEhLqDWeVkzteBt8Qdn6155LLYmgnef2FjaKbhK6ZVN3B', '6XqPDHK6xw2ek2zewsWyoafaLzYpxJPn9D1RhKNnD2U3U2G3', '6ZC1JBRwaJwzSAERrz2USv3Bztn8XgbafUt2PQtWKCmYNLa9', '6WkuzpX6Z3mataoeZYZ3Cdpk3XizX3526GxSKh1YrZFYoZ1U', '6XiK7tiHuJ5tWXtJJmhbWsS3h7ovdQYp38RQzY6wWqc2AWMQ', '6X7HD6Tyuh49X4NPy17V6Q1pERrGnHQrHJG3cPQu8bPRshBK', '6XcpTfzbrZWupPLKthbZ5YJcFFdHxK4b9Je5ARhhwLJ2pAHm', '6W5riDnAmZwNsoYwpytGepMzTvXfcHYeS1rLeZDTeL5KTtSH', '6ViLcHEH6ujkovt5C3dit8jUza5dq24V9AKbtoS34ffxTMVA', '6VmFmejC5TLb4LE85CCgNaTUdZd5GmeAgc8NhKv5PmfHV8L3', '6a3paYochic4YVwoGxu8PNdZWaHLvF8CAGP3W5x8BHZeJ4RA', '6aRT5aegWS57R9ZF3PZeSH3E5tpC8R8cC7hMjdQV4qXksSx6', '6ZKvuNC9PDVKC8HYU5Xsx5bzZzYahZ2Do4yfkai298S29HCV', '6Yv5aSM6DVPWcUqSG4bCAbZf9RZdx8awE9ANyeuFa5QHgZnk']
commissions =  [0, 0.086, 0.08, 0.085, 0.0791, 0.07, 0.085, 0.089, 0.08, 0.065, 0.09, 0.08, 0.0877, 0.09, 0.09, 0.065, 0.08, 0.05, 0.085, 0.09, 0.09, 0.082, 0.02, 0.091, 0.08, 0.091, 0.09, 0.08, 0.09, 0.085, 0.085, 0.092, 0.09, 0.07, 0.09, 0.09, 0.084, 0.085, 0.0886, 0.055, 0.09, 0.09, 0.065, 0.085, 0.085, 0.07, 0.06, 0.0925, 0.08, 0.0936, 0.085, 0.05, 0.07, 0.094, 0.02, 0.092, 0.04, 0.085, 0.06, 0.07, 0.07, 0.09, 0.03, 0.095, 0.095, 0.0868, 0.09, 0.08, 0.08, 0.09, 0.093, 0.094, 0.09, 0.086, 0.07, 0.09, 0.08, 0.095, 0.08, 0.07, 0.08, 0.092, 0.07, 0.095, 0.08, 0.094, 0.07, 0.095, 0.085, 0.07, 0.08, 0.08, 0.09, 0.097, 0.09, 0.09, 0.08, 0.03, 0.08, 0.09, 0.1]
pointWeights =  [0, 0.0052148042136205275, 0.004940833870927601, 0.004781163479830218, 0.005235776681803196, 0.00476459522996591, 0.0035126786959151506, 0.005116513246071088, 0.005031854382840382, 0.004565566506912385, 0.005339240858171028, 0.005098616739888544, 0.0050994556386158504, 0.005245214292485397, 0.005113087742934585, 0.004946426529109646, 0.00494195240256401, 0.004771096695102537, 0.004947335336064228, 0.004989140455975014, 0.004951110380337109, 0.004819123647240848, 0.004968936978292377, 0.005198166055528944, 0.0052705210707591505, 0.005168385150709554, 0.004718735432873142, 0.004704194521599825, 0.004837579419241596, 0.004765014679329564, 0.005057790335159616, 0.005267445108759025, 0.005066948312932714, 0.004866381608879128, 0.004956003956246398, 0.004911122874335487, 0.004529773494547298, 0.004883648941016191, 0.005035070161295058, 0.00466064169600715, 0.0049876024749749516, 0.004978933854792782, 0.0051031607746614555, 0.004934891671609178, 0.004811643466922363, 0.004665535271916439, 0.004578080079594711, 0.0052348678748486135, 0.004814929153604314, 0.0050178727373852705, 0.004958660468882869, 0.005188658536619467, 0.0032389879861313264, 0.0053323898518980225, 0.0050158453987942785, 0.004295720749628717, 0.003585173527599908, 0.004898679209880437, 0.004973760645974391, 0.004599611813595584, 0.00509379307220653, 0.0046292529019604225, 0.00481436988778611, 0.005102182059479598, 0.005084705002660707, 0.004673225176916751, 0.00498606449397489, 0.00464631050941566, 0.005047164284613731, 0.004930417545063542, 0.005256469517076762, 0.005082467939387889, 0.004568083203094306, 0.005003821183702882, 0.004799129894240037, 0.004058871675619114, 0.004699440762145087, 0.0048720441752884485, 0.005114555815707372, 0.005007526319748487, 0.005051568502932091, 0.005260664010713296, 0.004875749311334053, 0.004549347798184456, 0.0050020734780209936, 0.0049030834281987975, 0.003480381094913841, 0.004884557747970774, 0.003844183509655864, 0.005318478114670185, 0.005041571626431686, 0.005080370692569622, 0.0048239473149228615, 0.0048006678752401, 0.004795634482876259, 0.004969636060565132, 0.004629882076005902, 0.004727194328373484, 0.004955444690428194, 0.004896302330153068, 0.0054397688889932854]
stakedAmounts =  [0, 41980, 45000, 45000, 50991, 47099, 34999, 51208, 53145, 49332, 56171, 55000, 55125, 56650, 55999, 55999, 55939, 56000, 55971, 56154, 55999, 55000, 60935, 59167, 61000, 60167, 55000, 55500, 56484, 56763, 60847, 63160, 61000, 60000, 60000, 60000, 55800, 60858, 63161, 61000, 62999, 62899, 66472, 62994, 61526, 62721, 62700, 70412, 66457, 69120, 70415, 77070, 47684, 77000, 78596, 62970, 55600, 72550, 75981, 70343, 78511, 70003, 77617, 77000, 77361, 72413, 77000, 72694, 79525, 77000, 82645, 80000, 72696, 80108, 78517, 65000, 76162, 77809, 84411, 83990, 83920, 87307, 84000, 76999, 86111, 83150, 60609, 83000, 66473, 94079, 89000, 90000, 84602, 84000, 85000, 88840, 84026, 90628, 90184, 88888, 97979]

def getCC():
	cc = [0]
	for i in range(1, len(commissions)):
		cc.append(P * (1 - commissions[i]) * pointWeights[i])
	return cc

c = getCC()

def func(stake):
	funs = []
	stakes = 0
	for i in range(1, len(commissions)):
		funs.append(c[i] * stakedAmounts[i] / (stake[i] + stakedAmounts[i])**2 + stake[0])
		stakes = stakes + stake[i]
	funs.append(stakes - StakeLimit)
	return funs

op = [0]
average = StakeLimit / (len(commissions) - 1)
for i in range(1, len(commissions)):
	op.append(average)

root = fsolve(func, op)

print("===== 优化质押 =====")
total = 0
totalProfit = 0
for i in range(1, len(commissions)):
	total = total + root[i]
	profit = c[i] * root[i] / (stakedAmounts[i] + root[i])
	totalProfit = totalProfit + profit
	print("Stake: ", accounts[i], round(root[i]), "Profit: ", round(profit), "ARP: ", round(profit / root[i] * 100 * 365), "%")

print("Total Stake: ", round(total))
print("Total Profit: ", round(totalProfit))
print("Profit Rate: ", totalProfit / total * 100, "%", "ARP: ", totalProfit / total * 100 * 365, "%")

# 如果不做优化，平均stake
print()
print("===== 平均质押 =====")
total0 = 0
totalProfit0 = 0
for i in range(1, len(commissions)):
	total0 = total0 + average
	# print(i, c[i], average, stakedAmounts[i])
	profit0 = c[i] * average / (stakedAmounts[i] + average)
	totalProfit0 = totalProfit0 + profit0
	print("Stake: ", accounts[i], round(average), "Profit: ", round(profit0), "ARP: ", round(profit0 / average * 100 * 365), "%")

print("Total Stake: ", round(total0))
print("Total Profit: ", round(totalProfit0))
print("Profit Rate: ", totalProfit0 / total0 * 100, "%", "ARP: ", totalProfit0 / total0 * 100 * 365, "%")
print("Extra Profit: ", round(totalProfit - totalProfit0), (totalProfit - totalProfit0) / totalProfit0 * 100, "%")
